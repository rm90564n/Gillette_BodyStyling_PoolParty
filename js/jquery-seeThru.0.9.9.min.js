/* jQuery seeThru 0.9.9 - transparent HTML5 video - Copyright (c) 2012 Frederik Ring - for license, docs, et. al. see: see https://github.com/m90/jquery-seeThru */
(function(e){function t(t,n){var r=e("<canvas/>").attr({width:t.width,height:t.height}).get(0).getContext("2d");r.drawImage(n,0,0,t.width,t.height);var i=r.getImageData(0,0,t.width,t.height);for(var s=3,o=i.data.length;s<o;s+=4)i.data[s-1]=i.data[s-2]=i.data[s-3]=i.data[s],i.data[s]=255;return i}(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var n={init:function(n){n||(n={});var r=e.extend({start:"autoplay",end:"loop",mask:"",alphaMask:!1,width:"",height:""},n);return this.each(function(){e(this).data("seeThru")&&e.error("seeThru already initialized on selected element");var n=!1,i=r.alphaMask===!0,s;e(r.mask).length&&(s=e(r.mask)[0],s.tagName==="IMG"?(e(s).hide(),n=!0):e.error("Mask element must be <img>")),this.tagName==="VIDEO"?(e(this).bind("loadedmetadata.seeThru",function(){function m(e){d.drawImage(u,0,0,l.width,l.height*f);var t=d.getImageData(0,0,l.width,l.height),n=d.getImageData(0,l.height,l.width,l.height).data;for(var i=3,s=t.data.length;i<s;i+=4)t.data[i]=r.alphaMask?n[i-1]:Math.max(n[i-1],n[i-2],n[i-3]);p.putImageData(t,0,0,0,0,l.width,l.height),e&&(v=requestAnimationFrame(function(){m(!0)}))}var o=e(this),u=this,a=e(window),f=n?1:2,l={width:~~r.width,height:~~r.height};if(!l.height||!l.width)!o.attr("width")&&!o.attr("height")?(l.width=l.width||u.videoWidth,l.height=l.height||u.videoHeight/f):o.attr("height")?o.attr("width")?(l.width=l.width||~~u.width,l.height=l.height||~~u.height/f):(l.width=l.width||~~u.height*(u.videoWidth/Math.floor(u.videoHeight/f)),l.height=l.height||~~u.height):(l.width=l.width||~~u.width,l.height=l.height||~~u.width/(u.videoWidth/Math.floor(u.videoHeight/f)));var c=e("<canvas/>",{"class":"seeThru-buffer"}).attr({width:l.width,height:l.height*2}).hide(),h=e("<canvas/>",{"class":"seeThru-display"}).attr({width:l.width,height:l.height}),p=h[0].getContext("2d"),d=c[0].getContext("2d");h.bind("mouseenter mouseleave click mousedown mouseup mousemove mouseover hover dblclick contextmenu focus blur",function(e){o.trigger(e)}),n&&(s.width=l.width,s.height=l.height,i?d.putImageData(t(l,s),0,l.height):d.drawImage(s,0,l.height,l.width,l.height));var v;o.hide().data("seeThru",{staticMask:n,alphaMask:i,interval:v}).after(c,h),o.bind("play.seeThru",function(){cancelAnimationFrame(v),v=requestAnimationFrame(function(){m(!0)}),o.data("seeThru").interval=v}).bind("pause.seeThru",function(){cancelAnimationFrame(v)}),r.start==="autoplay"?o.trigger("play.seeThru"):r.start==="clicktoplay"?(u.play(),u.pause(),m(),h.one("click.seeThru",function(){u.play()})):r.start==="external"?(u.play(),u.pause(),o.bind("timeupdate.seeThru",function(){m()})):u.play(),r.end==="loop"?o.bind("ended.seeThru",function(){u.play()}):r.end==="rewind"?o.bind("ended.seeThru",function(){u.pause(),u.currentTime=0,r.start=="clicktoplay"&&h.one("click.seeThru",function(){u.play()})}):o.bind("ended.seeThru",function(){u.pause(),r.start=="clicktoplay"&&h.one("click.seeThru",function(){u.play()})})}),this.videoWidth&&this.videoHeight&&e(this).trigger("loadedmetadata.seeThru")):e.error("Selected element must be <video> element")})},updateMask:function(n){var r=e.extend({mask:""},n);return this.each(function(){var n=e(this);if(e(r.mask).length){var i=n.data("seeThru").staticMask,s=n.data("seeThru").alphaMask;if(i)if(e(r.mask)[0].tagName==="IMG"){var o={width:n.width(),height:n.height()},u=e(r.mask)[0];u.width=o.width,u.height=o.height;var a=n.nextAll(".seeThru-buffer")[0].getContext("2d");s?a.putImageData(t(o,u),0,o.height):a.drawImage(u,0,o.height,o.width,o.height)}else e.error("Passed mask element must be <img>");else e.error("Cannot apply method '.updateMask()' to element with moving alpha")}else e.error("Missing parameter 'mask'")})},revert:function(){return this.each(function(){var t=e(this);t.data("seeThru")&&(cancelAnimationFrame(t.data("seeThru").interval),t.show().unbind(".seeThru").removeData("seeThru").nextAll(".seeThru-buffer:first, .seeThru-display:first").remove())})},play:function(){return this.each(function(){e(this).data("seeThru")&&this.play()})},pause:function(){return this.each(function(){e(this).data("seeThru")&&this.pause()})},rewind:function(){return this.each(function(){e(this).data("seeThru")&&(this.pause(),this.currentTime=0)})}};e.fn.seeThru=function(t){if(n[t])return n[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return n.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.seeThru")}})(jQuery);